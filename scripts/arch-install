#!/usr/bin/env bash

PACKAGES=(
"arch-install-scripts"
"base"
"base-devel"
"eza"
"fakeroot-tcp"
"git"
"github-cli"
"glow"
"go"
"lazygit"
"less"
"lf"
"lua"
"nano"
"neovim"
"npm"
"python"
"python-pynvim"
"rust"
"stylua"
"sudo"
"unzip"
"vim"
"yay-bin"
"yay-bin-debug"
"zoxide"
"zsh"
)

echo "Setting up dotfiles"

echo "Installing yay..."
cd ~ # make sure we're in home dir
if command -v "yay" &>/dev/null; then
    echo "yay is installed..."
else
    sudo pacman -S --needed git base-devel && git clone https://aur.archlinux.org/yay.git && cd yay && makepkg -si
fi

### compare PACKAGES with what's been installed so far, 
### only install what hasn't been installed yet
echo "Installing pkgs..."
installed_packages=$(pacman -Qe | awk '{print $1}')
to_install=()
for package in "${PACKAGES[@]}"; do
    if ! echo "$installed_packages" | grep -q "^$package$"; then
        to_install+=("$package")
    else
        echo "Installed... skipping: $package"
    fi
done
yay -S ${to_install[@]}
rm -rf ~/yay

### Setup git
echo "Log Into Git via the CLI please..."
gh auth login
git config --global user.name "vague2k"
git config --global user.email "ilovedrawing056@gmail.com"

echo "Cloning repos..."
mkdir -p ~/Documents/Github
cd ~/Documents/Github

gh repo clone vague2k/huez.nvim
gh repo clone vague2k/vague.nvim
gh repo clone vague2k/rummage
gh repo clone vague2k/smv
gh repo clone vague2k/dotfiles


echo "Setting up zsh"
cd ~/Documents/Github/dotfiles/zsh
cp .zshenv ~/.zshenv

sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
mv ~/.oh-my-zsh ./ohmyzsh

source ~/.zshenv
source ./.zshrc
